# å¾®ä¿¡æˆæƒç™»å½•åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

GrammarMaster åº”ç”¨ç°å·²é›†æˆå®Œæ•´çš„å¾®ä¿¡æˆæƒç™»å½•ç³»ç»Ÿï¼Œæ”¯æŒå¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯å’Œæ¸¸å®¢æ¨¡å¼ä½“éªŒã€‚

## ä¸»è¦ç‰¹æ€§

### âœ… **å¾®ä¿¡æˆæƒç™»å½•**
- ä¸€é”®å¾®ä¿¡æˆæƒç™»å½•
- è‡ªåŠ¨è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- å®‰å…¨çš„ç™»å½•çŠ¶æ€ç®¡ç†
- ä¼šè¯è¿‡æœŸè‡ªåŠ¨å¤„ç†

### âœ… **æ¸¸å®¢æ¨¡å¼**
- æ— éœ€ç™»å½•å³å¯ä½“éªŒåŸºæœ¬åŠŸèƒ½
- åŠŸèƒ½å—é™æç¤º
- éšæ—¶å¯å‡çº§ä¸ºæ­£å¼ç”¨æˆ·

### âœ… **æ™ºèƒ½çŠ¶æ€ç®¡ç†**
- è‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€
- é¡µé¢è®¿é—®æƒé™æ§åˆ¶
- ç™»å½•çŠ¶æ€æŒä¹…åŒ–
- å®‰å…¨çš„é€€å‡ºç™»å½•

## æŠ€æœ¯æ¶æ„

### 1. æ ¸å¿ƒç»„ä»¶

#### `utils/loginManager.js`
- ç™»å½•çŠ¶æ€ç®¡ç†
- å¾®ä¿¡æˆæƒå¤„ç†
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- ä¼šè¯ç®¡ç†

#### `utils/authGuard.js`
- é¡µé¢è®¿é—®æƒé™æ§åˆ¶
- è·¯ç”±å®ˆå«
- å…¨å±€ç™»å½•çŠ¶æ€æ£€æŸ¥

#### `pages/login/index.vue`
- ç™»å½•é¡µé¢ç•Œé¢
- å¾®ä¿¡æˆæƒæŒ‰é’®
- æ¸¸å®¢æ¨¡å¼å…¥å£

### 2. æ•°æ®æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ç™»å½• â†’ å¾®ä¿¡æˆæƒ â†’ è·å–ç”¨æˆ·ä¿¡æ¯ â†’ åç«¯éªŒè¯ â†’ ä¿å­˜ç™»å½•çŠ¶æ€ â†’ è·³è½¬ä¸»é¡µé¢
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¾®ä¿¡ç™»å½•

#### åŸºæœ¬æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»"å¾®ä¿¡æˆæƒç™»å½•"æŒ‰é’®
2. è°ƒç”¨ `uni.login()` è·å–æˆæƒç 
3. è°ƒç”¨ `uni.getUserProfile()` è·å–ç”¨æˆ·ä¿¡æ¯
4. å‘é€åˆ°åç«¯éªŒè¯ï¼ˆå½“å‰ä¸ºæ¨¡æ‹ŸéªŒè¯ï¼‰
5. ä¿å­˜ç™»å½•çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
6. è·³è½¬åˆ°ä¸»é¡µé¢

#### ä»£ç ç¤ºä¾‹
```javascript
// å¤„ç†å¾®ä¿¡ç™»å½•
async handleWechatLogin() {
  try {
    // è·å–å¾®ä¿¡æˆæƒ
    const authResult = await this.getWechatAuth()
    
    if (authResult.success) {
      // ä½¿ç”¨æˆæƒä¿¡æ¯ç™»å½•
      const loginResult = await loginManager.wechatLogin(authResult.data)
      
      if (loginResult.success) {
        // ç™»å½•æˆåŠŸï¼Œè·³è½¬ä¸»é¡µé¢
        this.redirectToMain()
      }
    }
  } catch (error) {
    console.error('å¾®ä¿¡ç™»å½•å¤±è´¥:', error)
  }
}
```

### 2. æ¸¸å®¢æ¨¡å¼

#### å¯ç”¨æ–¹å¼
1. åœ¨ç™»å½•é¡µé¢ç‚¹å‡»"ä»¥æ¸¸å®¢èº«ä»½ä½“éªŒ"
2. ç¡®è®¤æ¸¸å®¢æ¨¡å¼é™åˆ¶æç¤º
3. è‡ªåŠ¨è®¾ç½®æ¸¸å®¢çŠ¶æ€
4. è·³è½¬ä¸»é¡µé¢

#### åŠŸèƒ½é™åˆ¶
- å­¦ä¹ è¿›åº¦ä¸ä¿å­˜
- æ— æ³•å‚ä¸æµ‹è¯„
- éƒ¨åˆ†é«˜çº§åŠŸèƒ½å—é™
- æ•°æ®ä¸ä¼šåŒæ­¥

### 3. ç™»å½•çŠ¶æ€æ£€æŸ¥

#### è‡ªåŠ¨æ£€æŸ¥
```javascript
// åœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
onLoad() {
  this.checkLoginStatus()
}

// æ£€æŸ¥ç™»å½•çŠ¶æ€
async checkLoginStatus() {
  const isLoggedIn = await loginManager.checkLoginStatus()
  
  if (!isLoggedIn) {
    // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µé¢
    uni.redirectTo({
      url: '/pages/login/index'
    })
  }
}
```

#### æ‰‹åŠ¨æ£€æŸ¥
```javascript
import { loginManager } from '@/utils/loginManager.js'

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
const isLoggedIn = await loginManager.checkLoginStatus()

// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
const currentUser = loginManager.getCurrentUser()

// è·å–ç™»å½•çŠ¶æ€
const loginStatus = loginManager.getLoginStatus()
```

## é¡µé¢æƒé™æ§åˆ¶

### 1. å—ä¿æŠ¤çš„é¡µé¢
ä»¥ä¸‹é¡µé¢éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®ï¼š
- `/pages/profile/index` - ä¸ªäººä¸­å¿ƒ
- `/pages/practice/exercise` - ç»ƒä¹ é¡µé¢
- `/pages/assessment/index` - èƒ½åŠ›æµ‹è¯„

### 2. å…¬å¼€é¡µé¢
ä»¥ä¸‹é¡µé¢æ— éœ€ç™»å½•å³å¯è®¿é—®ï¼š
- `/pages/login/index` - ç™»å½•é¡µé¢
- `/pages/index/index` - é¦–é¡µ

### 3. æƒé™æ£€æŸ¥å®ç°
```javascript
import { checkPageAccess } from '@/utils/authGuard.js'

// æ£€æŸ¥é¡µé¢è®¿é—®æƒé™
const hasAccess = await checkPageAccess('/pages/profile/index')

if (!hasAccess) {
  // è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
  console.log('é¡µé¢è®¿é—®è¢«æ‹’ç»')
}
```

## ç”¨æˆ·ä¿¡æ¯ç®¡ç†

### 1. ç”¨æˆ·æ•°æ®ç»“æ„
```javascript
{
  id: 'user_1234567890',
  openid: 'openid_abc123',
  unionid: 'unionid_xyz789',
  nickname: 'ç”¨æˆ·æ˜µç§°',
  avatar: 'å¤´åƒURL',
  gender: 1, // 0: æœªçŸ¥, 1: ç”·, 2: å¥³
  country: 'å›½å®¶',
  province: 'çœä»½',
  city: 'åŸå¸‚',
  language: 'zh_CN',
  createTime: 1640995200000,
  lastLoginTime: 1640995200000,
  loginCount: 1,
  isGuest: false
}
```

### 2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```javascript
// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
const result = await loginManager.updateUserInfo({
  nickname: 'æ–°æ˜µç§°',
  avatar: 'æ–°å¤´åƒURL'
})

if (result.success) {
  console.log('ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ')
}
```

## ä¼šè¯ç®¡ç†

### 1. ä¼šè¯è¿‡æœŸæ—¶é—´
- é»˜è®¤ä¼šè¯æ—¶é•¿ï¼š7å¤©
- è‡ªåŠ¨æ£€æŸ¥è¿‡æœŸçŠ¶æ€
- è¿‡æœŸåè‡ªåŠ¨æ¸…é™¤ç™»å½•çŠ¶æ€

### 2. ä¼šè¯åˆ·æ–°
```javascript
// åˆ·æ–°ç™»å½•çŠ¶æ€
const isStillValid = await loginManager.refreshLoginStatus()

if (!isStillValid) {
  // ä¼šè¯å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•
  uni.redirectTo({
    url: '/pages/login/index'
  })
}
```

## é€€å‡ºç™»å½•

### 1. é€€å‡ºæµç¨‹
```javascript
// é€€å‡ºç™»å½•
const result = await loginManager.logout()

if (result.success) {
  // æ¸…é™¤æ‰€æœ‰ç™»å½•çŠ¶æ€
  // è·³è½¬ç™»å½•é¡µé¢
  uni.redirectTo({
    url: '/pages/login/index'
  })
}
```

### 2. æ•°æ®æ¸…ç†
- æ¸…é™¤å†…å­˜ä¸­çš„ç”¨æˆ·ä¿¡æ¯
- æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ç™»å½•çŠ¶æ€
- æ¸…é™¤å¾®ä¿¡æˆæƒä»¤ç‰Œ
- æ¸…é™¤ä¼šè¯æ—¶é—´ä¿¡æ¯

## é”™è¯¯å¤„ç†

### 1. å¸¸è§é”™è¯¯
- å¾®ä¿¡æˆæƒå¤±è´¥
- ç½‘ç»œè¯·æ±‚è¶…æ—¶
- ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥
- ç™»å½•çŠ¶æ€éªŒè¯å¤±è´¥

### 2. é”™è¯¯å¤„ç†ç¤ºä¾‹
```javascript
try {
  const result = await loginManager.wechatLogin(authData)
  
  if (result.success) {
    // å¤„ç†æˆåŠŸæƒ…å†µ
  } else {
    // å¤„ç†ä¸šåŠ¡é”™è¯¯
    throw new Error(result.message)
  }
} catch (error) {
  // æ˜¾ç¤ºé”™è¯¯æç¤º
  uni.showModal({
    title: 'ç™»å½•å¤±è´¥',
    content: error.message || 'ç™»å½•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•',
    showCancel: false
  })
}
```

## å®‰å…¨è€ƒè™‘

### 1. æ•°æ®å®‰å…¨
- æ•æ„Ÿä¿¡æ¯ä¸å­˜å‚¨åœ¨æœ¬åœ°
- ä½¿ç”¨å®‰å…¨çš„å­˜å‚¨æ–¹å¼
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

### 2. æƒé™æ§åˆ¶
- ä¸¥æ ¼çš„é¡µé¢è®¿é—®æ§åˆ¶
- ç”¨æˆ·èº«ä»½éªŒè¯
- ä¼šè¯çŠ¶æ€ç®¡ç†

### 3. éšç§ä¿æŠ¤
- éµå¾ªå¾®ä¿¡å°ç¨‹åºéšç§æ”¿ç­–
- æœ€å°åŒ–ç”¨æˆ·ä¿¡æ¯æ”¶é›†
- ç”¨æˆ·å¯éšæ—¶é€€å‡ºç™»å½•

## åç»­æ‰©å±•

### 1. åŠŸèƒ½å¢å¼º
- æ·»åŠ æ‰‹æœºå·ç»‘å®š
- æ”¯æŒé‚®ç®±ç™»å½•
- ç¬¬ä¸‰æ–¹è´¦å·å…³è”
- å¤šè®¾å¤‡ç™»å½•ç®¡ç†

### 2. å®‰å…¨å‡çº§
- æ·»åŠ ç™»å½•æ—¥å¿—
- å¼‚å¸¸ç™»å½•æ£€æµ‹
- äºŒæ¬¡éªŒè¯æ”¯æŒ
- ç™»å½•è®¾å¤‡ç®¡ç†

### 3. ç”¨æˆ·ä½“éªŒ
- è®°ä½ç™»å½•çŠ¶æ€
- è‡ªåŠ¨ç™»å½•åŠŸèƒ½
- ç™»å½•çŠ¶æ€åŒæ­¥
- ä¸ªæ€§åŒ–è®¾ç½®

---

ğŸ‰ å¾®ä¿¡æˆæƒç™»å½•åŠŸèƒ½å·²å®Œå…¨é›†æˆï¼ç°åœ¨ç”¨æˆ·å¯ä»¥å®‰å…¨ã€ä¾¿æ·åœ°ä½¿ç”¨ GrammarMaster åº”ç”¨äº†ã€‚
